---
apiVersion: v1
kind: ServiceAccount
metadata:
  name: snyk-k8s-monitor
---
kind: ClusterRoleBinding
apiVersion: rbac.authorization.k8s.io/v1
metadata:
  name: snyk-k8s-monitor
subjects:
- kind: ServiceAccount
  name: snyk-k8s-monitor
roleRef:
  apiGroup: rbac.authorization.k8s.io
  kind: ClusterRole
  name: cluster-admin
---
apiVersion: apps/v1
kind: Deployment
metadata:
  name: snyk-k8s-monitor
spec:
  replicas: 1
  template:
    spec:
      serviceAccountName: snyk-k8s-monitor
      restartPolicy: Always
      containers:
      - name: snyk-k8s-monitor
        image: pivotalservices/pks-kubectl:1.4.0
        command: ["/bin/bash"]
        args:
          - "-c"
          - |
            #!/bin/bash
            set -eo pipefail
            while true; do
              kubectl get deployments --all-namespaces -o json
              sleep 60
            done
#        volumeMounts:
#        - name: docker-socket-mount
#          mountPath: /var/run/docker.sock
#      volumes:
#        - name: docker-socket-mount
#          hostPath:
#            path: /var/run/docker.sock